---
import { getPost, getPosts } from '../../lib/microcms';
import type { Post } from '../../types/blog';
import Layout from '../../layouts/Layout.astro';

export async function getStaticPaths() {
  const postsResponse = await getPosts();
  return postsResponse.contents.map((post: Post) => ({
    params: { slug: post.id },
  }));
}

const { slug } = Astro.params;
const post = await getPost(slug as string);
---

<Layout title={`${post.title} | VIVID YELLOW`} description={post.title}>
	<article class="post">
		<header class="post-header">
			<h1>{post.title}</h1>
			<div class="post-header-meta">
				<time datetime={post.publishedAt}>
					{new Date(post.publishedAt).toLocaleDateString('ja-JP')}
				</time>
				{post.tags && post.tags.length > 0 && (
					<div class="tags">
						{post.tags.map((tag) => (
							<a href={`/tags/${tag.id}`} class="tag">
								{tag.name}
							</a>
						))}
					</div>
				)}
			</div>
		</header>

		<div class="post-content" set:html={post.content}></div>

		<footer class="post-footer">
			<a href="/" class="back-link">← 記事一覧に戻る</a>
		</footer>
	</article>
</Layout>