---
import { getPosts, getTags } from '../../lib/microcms';
import type { Post, Tag } from '../../types/blog';
import Layout from '../../layouts/Layout.astro';

const tagsResponse = await getTags();
const postsResponse = await getPosts();
const tags: Tag[] = tagsResponse.contents;
const posts: Post[] = postsResponse.contents;

const tagCounts = tags.map(tag => {
  const count = posts.filter(post => 
    post.tags && post.tags.some(postTag => postTag.id === tag.id)
  ).length;
  return { ...tag, count };
});
---

<Layout title="タグ一覧 | VIVID YELLOW" description="VIVID YELLOWのタグ一覧ページ">
	<section class="tags-section">
		<h2>タグ一覧</h2>
		{tagCounts.length === 0 ? (
			<p>タグがありません。</p>
		) : (
			<div class="tags-grid">
				{tagCounts.map((tag) => (
					<div class="tag-card">
						<h3>
							<a href={`/tags/${tag.id}`}>{tag.name}</a>
						</h3>
						<p class="tag-count">{tag.count}件の記事</p>
					</div>
				))}
			</div>
		)}
	</section>
</Layout>
