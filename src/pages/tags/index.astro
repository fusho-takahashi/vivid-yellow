---
import { getPosts, getTags } from '../../lib/microcms';
import type { Post, Tag } from '../../types/blog';
import '../../styles/global.css';

const tagsResponse = await getTags();
const postsResponse = await getPosts();
const tags: Tag[] = tagsResponse.contents;
const posts: Post[] = postsResponse.contents;

const tagCounts = tags.map(tag => {
  const count = posts.filter(post => 
    post.tags && post.tags.some(postTag => postTag.id === tag.id)
  ).length;
  return { ...tag, count };
});
---

<html lang="ja">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="viewport" content="width=device-width" />
		<meta name="generator" content={Astro.generator} />
		<title>タグ一覧 | 個人ブログ</title>
		<meta name="description" content="個人ブログのタグ一覧ページ" />
	</head>
	<body>
		<header>
			<h1>
				<a href="/">個人ブログ</a>
			</h1>
			<nav>
				<a href="/">ホーム</a>
				<a href="/tags">タグ一覧</a>
			</nav>
		</header>

		<main>
			<section class="tags-section">
				<h2>タグ一覧</h2>
				{tagCounts.length === 0 ? (
					<p>タグがありません。</p>
				) : (
					<div class="tags-grid">
						{tagCounts.map((tag) => (
							<div class="tag-card">
								<h3>
									<a href={`/tags/${tag.id}`}>{tag.name}</a>
								</h3>
								<p class="tag-count">{tag.count}件の記事</p>
							</div>
						))}
					</div>
				)}
			</section>
		</main>

		<footer>
			<p>&copy; 2024 個人ブログ</p>
		</footer>
	</body>
</html>
